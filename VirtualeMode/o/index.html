<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>#o – ϻiapol𝐯o</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: #000; /* 完全黒 */
      overflow: hidden;
    }
    /* 星空キャンバス（⭐︎の固定描画 + 流れ星） */
    canvas#sky {
      position: fixed;
      inset: 0;
      display: block;
      background: #000;
      z-index: 0;
      pointer-events: none; /* クリック透過 */
    }
    /* 中央リンク（そのまま） */
    .center {
      position: relative;
      z-index: 1;
      height: 100%;
      display: grid;
      place-items: center;
    }
    .links {
      display: flex;
      gap: 4em;
    }
    .links a {
      text-decoration: none;
      color: #7F7F7F;
      font-size: 3.14159265359em;
      font-style: italic;
      letter-spacing: 0.01em;
      -webkit-tap-highlight-color: rgba(255,255,255,0.1);
    }
    .links a.femme { font-family: Futura, sans-serif; }
    .links a.homme { font-family: Helvetica, Arial, sans-serif; }
    .links a:hover { text-decoration: underline; }
    .links a:focus-visible {
      outline: 2px dashed #7F7F7F;
      outline-offset: 6px;
    }
  </style>
</head>
<body>
  <canvas id="sky" aria-hidden="true"></canvas>

  <div class="center">
    <nav class="links" aria-label="primary">
      <a class="femme" href="https://opensea.io/item/ethereum/0xd91cd9974a4e19e4d23a4a2d94e2e5dd172eee8d/2" target="_blank" rel="noopener">Femme</a>
      <a class="homme" href="https://opensea.io/item/ethereum/0xd91cd9974a4e19e4d23a4a2d94e2e5dd172eee8d/1" target="_blank" rel="noopener">Homme</a>
    </nav>
  </div>

  <script>
    /* =========================
       1) 画像→⭐︎座標 抽出設定
       ========================= */
    const SOURCE_IMAGE = 'sky-1728.png'; // Your Sky で保存したPNG
    const IMG_SIZE = 1728;               // 正方・円形の星図
    const THRESH = 235;                  // 白検出しきい値（R/G/B >= 235）
    const STEP = 2;                      // 走査間隔（軽量化）
    const MIN_BLOB = 1;                  // 連結成分の最小ピクセル数
    const MAX_BLOB = 80;                 // 大きすぎる塊を除外
    const STAR_CHAR = '⭐︎';              // 星は記号のみ
    const STAR_COLOR = '#FFF';           // 星は白のみ
    const STAR_FONT_PX = 9;              // ⭐︎の基準サイズ（px）

    /* =========================
       2) 流れ星（既存仕様）
       ========================= */
    const PROB_BASE = 1/19;              // 通常
    const PROB_RARE = 1/114;             // レア（白）
    const PROB_ULTRA = 1/786;            // 超レア（交差）
    const METEOR_INTERVAL_MS = 1000;
    const STAR_CHARS = ["⭐︎","✳︎","✴︎","★"]; // 流れ星の文字種（色は#7F7F7F/#FFFのみ）

    const canvas = document.getElementById('sky');
    const ctx = canvas.getContext('2d');

    let starNorms = [];  // 0..1 に正規化した⭐︎座標の配列 [{x,y,weight}]
    let starField = null; // オフスクリーンの固定描画
    const meteors = [];

    function fitCanvas() {
      const w = window.innerWidth, h = window.innerHeight;
      canvas.width = w;
      canvas.height = h;
      renderStarField();  // サイズに合わせて⭐︎を描き直す
    }
    window.addEventListener('resize', fitCanvas, { passive: true });

    /* =========================
       画像から白点を検出 → 連結成分で重心抽出
       ========================= */
    async function extractStars() {
      const img = await loadImage(SOURCE_IMAGE);

      const off = document.createElement('canvas');
      off.width = IMG_SIZE;
      off.height = IMG_SIZE;
      const ox = off.getContext('2d');
      ox.drawImage(img, 0, 0, IMG_SIZE, IMG_SIZE);

      const cx = IMG_SIZE/2, cy = IMG_SIZE/2, R = IMG_SIZE/2;
      const src = ox.getImageData(0, 0, IMG_SIZE, IMG_SIZE);
      const mask = new Uint8Array(IMG_SIZE * IMG_SIZE);

      for (let y = 0; y < IMG_SIZE; y += STEP) {
        const dy = y - cy, dy2 = dy*dy;
        for (let x = 0; x < IMG_SIZE; x += STEP) {
          const dx = x - cx;
          if (dx*dx + dy2 > R*R) continue; // 円外は無視
          const i = (y * IMG_SIZE + x) * 4;
          const r = src.data[i], g = src.data[i+1], b = src.data[i+2];
          if (r >= THRESH && g >= THRESH && b >= THRESH) mask[y*IMG_SIZE + x] = 1;
        }
      }

      // 連結成分 → 重心
      const visited = new Uint8Array(mask.length);
      const qx = [], qy = [];
      const stars = [];
      for (let y0 = 0; y0 < IMG_SIZE; y0 += STEP) {
        for (let x0 = 0; x0 < IMG_SIZE; x0 += STEP) {
          const idx0 = y0*IMG_SIZE + x0;
          if (!mask[idx0] || visited[idx0]) continue;

          let sumX = 0, sumY = 0, count = 0;
          let head = 0, tail = 0;
          qx[tail] = x0; qy[tail] = y0; tail++;
          visited[idx0] = 1;

          while (head < tail) {
            const x = qx[head], y = qy[head]; head++;
            const idx = y*IMG_SIZE + x;
            sumX += x; sumY += y; count++;

            // 4近傍（STEPグリッド）
            neigh(x+STEP, y);
            neigh(x-STEP, y);
            neigh(x, y+STEP);
            neigh(x, y-STEP);

            function neigh(nx, ny){
              if (nx<0 || ny<0 || nx>=IMG_SIZE || ny>=IMG_SIZE) return;
              const nidx = ny*IMG_SIZE + nx;
              if (!mask[nidx] || visited[nidx]) return;
              visited[nidx] = 1;
              qx[tail]=nx; qy[tail]=ny; tail++;
            }
          }

          if (count >= MIN_BLOB && count <= MAX_BLOB) {
            const gx = sumX / count;
            const gy = sumY / count;
            // 円の境界から2px内側のみ採用（ノイズ除去）
            const dx = gx - cx, dy = gy - cy;
            if (dx*dx + dy*dy <= (R-2)*(R-2)) {
              stars.push({ x: gx/IMG_SIZE, y: gy/IMG_SIZE, w: count });
            }
          }
        }
      }
      starNorms = stars;
    }

    /* =========================
       正規化座標をビューポートに投影して⭐︎描画（オフスクリーン）
       ========================= */
    function renderStarField() {
      if (!starNorms.length) return;
      const w = canvas.width, h = canvas.height;
      const size = Math.min(w, h);
      const off = document.createElement('canvas');
      off.width = w;
      off.height = h;
      const ox = off.getContext('2d');

      // 背景
      ox.fillStyle = '#000';
      ox.fillRect(0, 0, w, h);

      // 円形クリップ
      ox.save();
      ox.beginPath();
      ox.arc(w/2, h/2, size/2, 0, Math.PI*2);
      ox.clip();

      // ⭐︎描画
      ox.fillStyle = STAR_COLOR;
      ox.textAlign = 'center';
      ox.textBaseline = 'middle';

      const fontPx = Math.max(6, STAR_FONT_PX * (size / IMG_SIZE)); // サイズに追随
      ox.font = `${fontPx}px serif`;

      const offsetX = (w - size)/2;
      const offsetY = (h - size)/2;

      for (let i=0;i<starNorms.length;i++){
        const sx = offsetX + starNorms[i].x * size;
        const sy = offsetY + starNorms[i].y * size;
        ox.fillText(STAR_CHAR, sx, sy);
      }

      ox.restore();
      starField = off;
      // 一度描いておく
      ctx.clearRect(0, 0, w, h);
      ctx.drawImage(starField, 0, 0);
    }

    /* =========================
       流れ星（記号）
       ========================= */
    function spawnMeteor(options={}) {
      const w = canvas.width;
      const h = canvas.height;

      const side = Math.floor(Math.random() * 4); // 0:左,1:右,2:上