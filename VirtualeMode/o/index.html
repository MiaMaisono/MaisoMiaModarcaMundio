<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>#o â€“ Ï»iapolğ¯o</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: #000; /* å®Œå…¨é»’ */
      overflow: hidden;
    }
    /* æ˜Ÿç©ºã‚­ãƒ£ãƒ³ãƒã‚¹ï¼ˆâ­ï¸ã®å›ºå®šæç”» + æµã‚Œæ˜Ÿï¼‰ */
    canvas#sky {
      position: fixed;
      inset: 0;
      display: block;
      background: #000;
      z-index: 0;
      pointer-events: none; /* ã‚¯ãƒªãƒƒã‚¯é€é */
    }
    /* ä¸­å¤®ãƒªãƒ³ã‚¯ï¼ˆãã®ã¾ã¾ï¼‰ */
    .center {
      position: relative;
      z-index: 1;
      height: 100%;
      display: grid;
      place-items: center;
    }
    .links {
      display: flex;
      gap: 4em;
    }
    .links a {
      text-decoration: none;
      color: #7F7F7F;
      font-size: 3.14159265359em;
      font-style: italic;
      letter-spacing: 0.01em;
      -webkit-tap-highlight-color: rgba(255,255,255,0.1);
    }
    .links a.femme { font-family: Futura, sans-serif; }
    .links a.homme { font-family: Helvetica, Arial, sans-serif; }
    .links a:hover { text-decoration: underline; }
    .links a:focus-visible {
      outline: 2px dashed #7F7F7F;
      outline-offset: 6px;
    }
  </style>
</head>
<body>
  <canvas id="sky" aria-hidden="true"></canvas>

  <div class="center">
    <nav class="links" aria-label="primary">
      <a class="femme" href="https://opensea.io/item/ethereum/0xd91cd9974a4e19e4d23a4a2d94e2e5dd172eee8d/2" target="_blank" rel="noopener">Femme</a>
      <a class="homme" href="https://opensea.io/item/ethereum/0xd91cd9974a4e19e4d23a4a2d94e2e5dd172eee8d/1" target="_blank" rel="noopener">Homme</a>
    </nav>
  </div>

  <script>
    /* =========================
       1) ç”»åƒâ†’â­ï¸åº§æ¨™ æŠ½å‡ºè¨­å®š
       ========================= */
    const SOURCE_IMAGE = 'sky-1728.png'; // Your Sky ã§ä¿å­˜ã—ãŸPNG
    const IMG_SIZE = 1728;               // æ­£æ–¹ãƒ»å††å½¢ã®æ˜Ÿå›³
    const THRESH = 235;                  // ç™½æ¤œå‡ºã—ãã„å€¤ï¼ˆR/G/B >= 235ï¼‰
    const STEP = 2;                      // èµ°æŸ»é–“éš”ï¼ˆè»½é‡åŒ–ï¼‰
    const MIN_BLOB = 1;                  // é€£çµæˆåˆ†ã®æœ€å°ãƒ”ã‚¯ã‚»ãƒ«æ•°
    const MAX_BLOB = 80;                 // å¤§ãã™ãã‚‹å¡Šã‚’é™¤å¤–
    const STAR_CHAR = 'â­ï¸';              // æ˜Ÿã¯è¨˜å·ã®ã¿
    const STAR_COLOR = '#FFF';           // æ˜Ÿã¯ç™½ã®ã¿
    const STAR_FONT_PX = 9;              // â­ï¸ã®åŸºæº–ã‚µã‚¤ã‚ºï¼ˆpxï¼‰

    /* =========================
       2) æµã‚Œæ˜Ÿï¼ˆæ—¢å­˜ä»•æ§˜ï¼‰
       ========================= */
    const PROB_BASE = 1/19;              // é€šå¸¸
    const PROB_RARE = 1/114;             // ãƒ¬ã‚¢ï¼ˆç™½ï¼‰
    const PROB_ULTRA = 1/786;            // è¶…ãƒ¬ã‚¢ï¼ˆäº¤å·®ï¼‰
    const METEOR_INTERVAL_MS = 1000;
    const STAR_CHARS = ["â­ï¸","âœ³ï¸","âœ´ï¸","â˜…"]; // æµã‚Œæ˜Ÿã®æ–‡å­—ç¨®ï¼ˆè‰²ã¯#7F7F7F/#FFFã®ã¿ï¼‰

    const canvas = document.getElementById('sky');
    const ctx = canvas.getContext('2d');

    let starNorms = [];  // 0..1 ã«æ­£è¦åŒ–ã—ãŸâ­ï¸åº§æ¨™ã®é…åˆ— [{x,y,weight}]
    let starField = null; // ã‚ªãƒ•ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã®å›ºå®šæç”»
    const meteors = [];

    function fitCanvas() {
      const w = window.innerWidth, h = window.innerHeight;
      canvas.width = w;
      canvas.height = h;
      renderStarField();  // ã‚µã‚¤ã‚ºã«åˆã‚ã›ã¦â­ï¸ã‚’æãç›´ã™
    }
    window.addEventListener('resize', fitCanvas, { passive: true });

    /* =========================
       ç”»åƒã‹ã‚‰ç™½ç‚¹ã‚’æ¤œå‡º â†’ é€£çµæˆåˆ†ã§é‡å¿ƒæŠ½å‡º
       ========================= */
    async function extractStars() {
      const img = await loadImage(SOURCE_IMAGE);

      const off = document.createElement('canvas');
      off.width = IMG_SIZE;
      off.height = IMG_SIZE;
      const ox = off.getContext('2d');
      ox.drawImage(img, 0, 0, IMG_SIZE, IMG_SIZE);

      const cx = IMG_SIZE/2, cy = IMG_SIZE/2, R = IMG_SIZE/2;
      const src = ox.getImageData(0, 0, IMG_SIZE, IMG_SIZE);
      const mask = new Uint8Array(IMG_SIZE * IMG_SIZE);

      for (let y = 0; y < IMG_SIZE; y += STEP) {
        const dy = y - cy, dy2 = dy*dy;
        for (let x = 0; x < IMG_SIZE; x += STEP) {
          const dx = x - cx;
          if (dx*dx + dy2 > R*R) continue; // å††å¤–ã¯ç„¡è¦–
          const i = (y * IMG_SIZE + x) * 4;
          const r = src.data[i], g = src.data[i+1], b = src.data[i+2];
          if (r >= THRESH && g >= THRESH && b >= THRESH) mask[y*IMG_SIZE + x] = 1;
        }
      }

      // é€£çµæˆåˆ† â†’ é‡å¿ƒ
      const visited = new Uint8Array(mask.length);
      const qx = [], qy = [];
      const stars = [];
      for (let y0 = 0; y0 < IMG_SIZE; y0 += STEP) {
        for (let x0 = 0; x0 < IMG_SIZE; x0 += STEP) {
          const idx0 = y0*IMG_SIZE + x0;
          if (!mask[idx0] || visited[idx0]) continue;

          let sumX = 0, sumY = 0, count = 0;
          let head = 0, tail = 0;
          qx[tail] = x0; qy[tail] = y0; tail++;
          visited[idx0] = 1;

          while (head < tail) {
            const x = qx[head], y = qy[head]; head++;
            const idx = y*IMG_SIZE + x;
            sumX += x; sumY += y; count++;

            // 4è¿‘å‚ï¼ˆSTEPã‚°ãƒªãƒƒãƒ‰ï¼‰
            neigh(x+STEP, y);
            neigh(x-STEP, y);
            neigh(x, y+STEP);
            neigh(x, y-STEP);

            function neigh(nx, ny){
              if (nx<0 || ny<0 || nx>=IMG_SIZE || ny>=IMG_SIZE) return;
              const nidx = ny*IMG_SIZE + nx;
              if (!mask[nidx] || visited[nidx]) return;
              visited[nidx] = 1;
              qx[tail]=nx; qy[tail]=ny; tail++;
            }
          }

          if (count >= MIN_BLOB && count <= MAX_BLOB) {
            const gx = sumX / count;
            const gy = sumY / count;
            // å††ã®å¢ƒç•Œã‹ã‚‰2pxå†…å´ã®ã¿æ¡ç”¨ï¼ˆãƒã‚¤ã‚ºé™¤å»ï¼‰
            const dx = gx - cx, dy = gy - cy;
            if (dx*dx + dy*dy <= (R-2)*(R-2)) {
              stars.push({ x: gx/IMG_SIZE, y: gy/IMG_SIZE, w: count });
            }
          }
        }
      }
      starNorms = stars;
    }

    /* =========================
       æ­£è¦åŒ–åº§æ¨™ã‚’ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã«æŠ•å½±ã—ã¦â­ï¸æç”»ï¼ˆã‚ªãƒ•ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ï¼‰
       ========================= */
    function renderStarField() {
      if (!starNorms.length) return;
      const w = canvas.width, h = canvas.height;
      const size = Math.min(w, h);
      const off = document.createElement('canvas');
      off.width = w;
      off.height = h;
      const ox = off.getContext('2d');

      // èƒŒæ™¯
      ox.fillStyle = '#000';
      ox.fillRect(0, 0, w, h);

      // å††å½¢ã‚¯ãƒªãƒƒãƒ—
      ox.save();
      ox.beginPath();
      ox.arc(w/2, h/2, size/2, 0, Math.PI*2);
      ox.clip();

      // â­ï¸æç”»
      ox.fillStyle = STAR_COLOR;
      ox.textAlign = 'center';
      ox.textBaseline = 'middle';

      const fontPx = Math.max(6, STAR_FONT_PX * (size / IMG_SIZE)); // ã‚µã‚¤ã‚ºã«è¿½éš
      ox.font = `${fontPx}px serif`;

      const offsetX = (w - size)/2;
      const offsetY = (h - size)/2;

      for (let i=0;i<starNorms.length;i++){
        const sx = offsetX + starNorms[i].x * size;
        const sy = offsetY + starNorms[i].y * size;
        ox.fillText(STAR_CHAR, sx, sy);
      }

      ox.restore();
      starField = off;
      // ä¸€åº¦æã„ã¦ãŠã
      ctx.clearRect(0, 0, w, h);
      ctx.drawImage(starField, 0, 0);
    }

    /* =========================
       æµã‚Œæ˜Ÿï¼ˆè¨˜å·ï¼‰
       ========================= */
    function spawnMeteor(options={}) {
      const w = canvas.width;
      const h = canvas.height;

      const side = Math.floor(Math.random() * 4); // 0:å·¦,1:å³,2:ä¸Š