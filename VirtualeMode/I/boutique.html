<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ϻiapolVo — Free Boutique (144)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#000; --fg:#7F7F7F; --white:#FFF;
      --gap:12px; --phiInv:0.618033988749;  /* 画像はタイルの 1/φ */
      --pad:72px;                           /* 四隅 UI の作業余白 */
      --speed:.18s;
    }
    html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font-family:Georgia,serif;}
    a{color:inherit;text-decoration:none}

    /* 画面全体 */
    .stage{min-height:100vh;display:flex;flex-direction:column}

    /* グリッド（下から上に埋まる） */
    .wrap{flex:1;display:flex;align-items:flex-end;justify-content:center;padding:var(--pad) 12px}
    .grid{
      width:100%;max-width:1400px;
      display:grid;gap:var(--gap);
      grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
      align-content:end;
    }
    .card{background:var(--fg);aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .card img{max-width:calc(100%*var(--phiInv));max-height:calc(100%*var(--phiInv));display:block;object-fit:contain}

    /* ───────── 四隅 UI（アイコン→展開） ───────── */
    .ctrl{position:fixed;z-index:10;display:flex;gap:8px;align-items:center}
    .TL{top:8px;left:8px}
    .TR{top:8px;right:8px}
    .BL{bottom:8px;left:8px}
    .BR{bottom:8px;right:8px}

    /* アイコン（枠なし・白） */
    .icon-btn{
      appearance:none;border:none;background:transparent;color:var(--white);
      font:inherit;font-size:20px;line-height:1;cursor:pointer;padding:6px;
    }

    /* 展開パネル（枠なし・透過、表示/非表示にトランジション） */
    .panel{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .panel.hidden{opacity:0;pointer-events:none;transform:translateY(-6px);transition:opacity var(--speed), transform var(--speed)}
    .panel.show  {opacity:1;transform:translateY(0);transition:opacity var(--speed), transform var(--speed)}

    /* ボタン群（枠なし・テキストのみ） */
    .btn, .chip, .size-btn{
      appearance:none;border:none;background:transparent;color:var(--fg);
      cursor:pointer;font:inherit;padding:2px 4px;
    }
    .btn[data-active="true"], .chip[data-active="true"], .size-btn[data-active="true"]{color:var(--white)}

    /* サイズ図形（■▮▯） */
    .size-btn{font-size:18px;line-height:1}

    /* カラー（花アイコンで展開） */
    .emoji{font-size:18px;line-height:1;padding:2px 3px}
    .emoji[data-active="true"]{color:var(--white)}

    /* 右下ランダム（⟲⟳ トグル） */
    .rand[data-active="true"]{color:var(--white)}

    /* フッター：中央下のブランド（48px） */
    .brand-wrap{position:fixed;left:0;right:0;bottom:20px;display:flex;justify-content:center;pointer-events:none}
    .brand{
      pointer-events:auto;color:var(--fg);font-size:48px;line-height:1;text-decoration:none;
    }
    .brand:hover{color:var(--white)}
  </style>
</head>
<body>
  <div class="stage">

    <!-- 左上：カテゴリ（☰ → All/ジュエリー/バッグ/ウェア/パターン） -->
    <div class="ctrl TL">
      <button class="icon-btn" id="catToggle" aria-label="カテゴリ">亖</button>
      <div class="panel hidden" id="stylePanel" aria-label="スタイル">
        <button class="btn" data-style="all" data-active="true">All</button>
        <button class="btn" data-style="jewelry">ジュエリー</button>
        <button class="btn" data-style="bag">バッグ</button>
        <button class="btn" data-style="wear">ウェア</button>
        <button class="btn" data-style="pattern">パターン</button>
      </div>
    </div>

    <!-- 右上：サイズ（◇ → ■ ▮ ▯）※◇はメニュー呼び出し用アイコン -->
    <div class="ctrl TR">
      <button class="icon-btn" id="sizeToggle" aria-label="サイズ">◇</button>
      <div class="panel hidden" id="sizePanel" aria-label="サイズ">
        <button class="size-btn" data-size="square" title="正方">■</button>
        <button class="size-btn" data-size="tall"   title="縦長">▮</button>
        <button class="size-btn" data-size="wide"   title="横長">▯</button>
      </div>
    </div>

    <!-- 左下：カラー（💐 → 🌷🌹🥀🪻🪷🌺🌸🌼🌻🏵️🥦） -->
    <div class="ctrl BL">
      <button class="icon-btn" id="colorToggle" aria-label="カラー">💐</button>
      <div class="panel hidden" id="colorPanel" aria-label="カラー">
        <button class="emoji" data-color="pink">🌷</button>
        <button class="emoji" data-color="red">🌹</button>
        <button class="emoji" data-color="black">🥀</button>
        <button class="emoji" data-color="purple">🪻</button>
        <button class="emoji" data-color="pink">🪷</button>
        <button class="emoji" data-color="red">🌺</button>
        <button class="emoji" data-color="pink">🌸</button>
        <button class="emoji" data-color="yellow">🌼</button>
        <button class="emoji" data-color="yellow">🌻</button>
        <button class="emoji" data-color="yellow">🏵️</button>
        <button class="emoji" data-color="green">🥦</button>
      </div>
    </div>

    <!-- 右下：ランダム（⟲⟳） -->
    <div class="ctrl BR">
      <button class="icon-btn rand" id="randToggle" aria-label="ランダム">⟳</button>
    </div>

    <!-- 一覧（下から上へ埋まる） -->
    <main class="wrap">
      <section id="grid" class="grid" aria-live="polite"></section>
    </main>

    <!-- 中央下：ブランド 48px -->
    <div class="brand-wrap">
      <a class="brand" href="https://abcdefghijklnopqrstuw.xyz">Vϻ</a>
    </div>
  </div>

  <script>
    /* ===== データ ===== */
    const DATA_URL = 'products.json';   // 144点のデータ
    const GRID = document.getElementById('grid');

    /* ===== UI 開閉 ===== */
    const toggles = [
      ['catToggle','stylePanel'],
      ['sizeToggle','sizePanel'],
      ['colorToggle','colorPanel']
    ];
    toggles.forEach(([btnId,panelId])=>{
      const b = document.getElementById(btnId);
      const p = document.getElementById(panelId);
      b.addEventListener('click', ()=>{
        const show = p.classList.contains('hidden');
        document.querySelectorAll('.panel').forEach(x=>x.classList.add('hidden'));
        if(show){ p.classList.remove('hidden'); p.classList.add('show'); }
        else    { p.classList.add('hidden'); p.classList.remove('show'); }
      });
    });
    // どこか別をクリックで全部閉じる
    document.addEventListener('click',(e)=>{
      if(e.target.closest('.ctrl')) return;
      document.querySelectorAll('.panel').forEach(x=>{x.classList.add('hidden');x.classList.remove('show');});
    });

    /* ===== 状態 ===== */
    let items = [];             // 全144
    let styleSel = 'all';       // jewelry/bag/wear/pattern/all
    let sizeSel  = null;        // tall/square/wide/null
    let colorsSel = new Set();  // 複数可
    let randSeed = 0;           // 疑似ランダムの種

    /* ===== ユーティリティ ===== */
    function shuffle(a, seed=0){
      const r = a.slice();
      let s = seed || Date.now();
      for(let i=r.length-1;i>0;i--){
        s ^= s << 13; s ^= s >> 17; s ^= s << 5; s >>>= 0;
        const j = Math.abs(s) % (i+1);
        [r[i], r[j]] = [r[j], r[i]];
      }
      return r;
    }
    function passStyle(it){ return (styleSel==='all') || (it.style===styleSel); }
    function passSize(it){ return !sizeSel || (it.size===sizeSel); }
    function passColor(it){
      if(colorsSel.size===0) return true;
      if(!Array.isArray(it.colors)) return false;
      for(const c of it.colors){ if(colorsSel.has(c)) return true; }
      return false;
    }
    function card(it){
      const el = document.createElement('article');
      el.className = 'card';
      const img = document.createElement('img');
      img.src = it.thumb; img.alt = it.title || 'Artwork';
      img.loading='lazy'; img.decoding='async';
      el.appendChild(img);
      return el;
    }
    function render(){
      const filtered = items.filter(it => passStyle(it)&&passSize(it)&&passColor(it));
      const listed = randSeed ? shuffle(filtered, randSeed) : filtered;
      GRID.innerHTML = '';
      for(const it of listed){ GRID.appendChild(card(it)); }
    }

    /* ===== クリック動作 ===== */
    // スタイル
    document.getElementById('stylePanel').addEventListener('click', e=>{
      const b = e.target.closest('.btn'); if(!b) return;
      styleSel = b.dataset.style;
      for(const el of e.currentTarget.querySelectorAll('.btn')) el.dataset.active = (el===b) ? "true" : "false";
      render();
    });
    // サイズ
    document.getElementById('sizePanel').addEventListener('click', e=>{
      const b = e.target.closest('.size-btn'); if(!b) return;
      const prev = e.currentTarget.querySelector('[data-active="true"]');
      if(prev===b){ b.removeAttribute('data-active'); sizeSel=null; }
      else{
        if(prev) prev.removeAttribute('data-active');
        b.dataset.active = "true"; sizeSel = b.dataset.size;
      }
      render();
    });
    // カラー（花アイコン）
    document.getElementById('colorPanel').addEventListener('click', e=>{
      const c = e.target.closest('.emoji'); if(!c) return;
      const name = c.dataset.color;
      if(c.dataset.active==="true"){ c.dataset.active="false"; colorsSel.delete(name); }
      else{ c.dataset.active="true"; colorsSel.add(name); }
      render();
    });
    // ランダム（⟲⟳）
    document.getElementById('randToggle').addEventListener('click', e=>{
      const b = e.currentTarget;
      randSeed = (randSeed?0:Date.now());
      b.dataset.active = randSeed ? "true":"false";
      render();
    });

    /* ===== データ読込 ===== */
    (async () => {
      const res = await fetch('products.json');
      const data = await res.json();
      items = data.sort((a,b)=>(a.order||0)-(b.order||0));  // 安定順
      render();
    })();
  </script>
</body>
</html>
